# H5é¡µé¢&å°ç¨‹åºå¦‚ä½•å®ç°emojiè¡¨æƒ…ï¼Ÿ

emojiè¡¨æƒ…éƒ½éå¸¸ç†Ÿæ‚‰äº†ï¼Œæ¯”å¦‚å¾®ä¿¡çš„ä¼šè¯çª—å£å¯ä»¥å‘è¡¨æƒ…ã€‚   
ä½†æ˜¯ä»”ç»†çœ‹æœ‰ä¸€ä¸ªé‡è¦çš„å‘ç°ï¼Œæ¯”å¦‚æœ‹å‹ç»™ä½ å‘ä¸€ä¸ªemojiè¡¨æƒ…ï¼Œåœ¨èŠå¤©ä¼šè¯åˆ—è¡¨é¡µæŸ¥çœ‹æœ€è¿‘æ¶ˆæ¯ï¼Œä¼šå‘ç°æœ‰ç‚¹ä¸åŒï¼Œä½“ç°åœ¨å¦‚ä¸‹ï¼š  

- åˆ—è¡¨é¡µçœ‹åˆ°çš„å°±æ˜¯ä¸€ä¸ªè¡¨æƒ…ï¼Œæ¯”å¦‚å¤§ç¬‘ğŸ˜„çš„è¡¨æƒ…ã€‚
- åˆ—è¡¨é¡µçœ‹åˆ°çš„æ˜¯ä¸€ä¸ªæ–‡å­—ï¼Œæ¯”å¦‚[å‘å‘†]ï¼Œ[æ‡µé€¼]

å‰è€…å°±æ˜¯é»˜è®¤emojiè¡¨æƒ…äº†ï¼Œåè€…åˆ™æ˜¯è‡ªå®šä¹‰è¡¨æƒ…ã€‚æ˜¾ç„¶ä½ æ‹¿ç€å¾®ä¿¡çš„[æ‡µé€¼]åœ¨å¾®åšä¸Šæ˜¯æ˜¾ç¤ºä¸å‡ºå¾®ä¿¡çš„[æ‡µé€¼]è¡¨æƒ…çš„ã€‚    
æœ¬æ–‡å°±è®²è¿°åœ¨H5å’Œå¾®ä¿¡å°ç¨‹åºä¸‹çš„è¿™ä¸¤ç§emojiè¡¨æƒ…çš„å®ç°ã€‚   

## è‡ªå®šä¹‰emojiè¡¨æƒ…

è‡ªå®šä¹‰ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è‡ªå·±å®šä¹‰çš„è¡¨æƒ…ï¼Œä¸æ˜¯é€šç”¨çš„è¡¨æƒ…ï¼ŒæŒ‰ç…§è‡ªå·±ç³»ç»Ÿçš„ä¸€å¥—è§£æè§„åˆ™æ¥å®ç°çš„ï¼Œåªåœ¨æˆ‘çš„ç³»ç»Ÿé‡Œé¢èƒ½è¯†åˆ«çš„ã€‚         
ç¤ºä¾‹ï¼š  
![ä¹°ä¹°ä¹°](./images/emoji4h5_2.gif)  

### è¡¨æƒ…å®šä¹‰

é¦–å…ˆä½ éœ€è¦å®šä¹‰è‡ªå·±çš„ä¸€å¥—è§„åˆ™çš„è¡¨æƒ…ï¼Œæ˜¯ç»å¯¹è·¯å¾„çš„è¡¨æƒ…ã€‚æ¯”å¦‚ï¼š  

```js
export default emojiData = {
    "ä¹°ä¹°ä¹°": ["1",true,1]
}
```  

è¿™é‡Œæˆ‘ä»¬çº¦å®šè¡¨æƒ…å›¾ç‰‡æœ‰ç»Ÿä¸€çš„è·¯å¾„æ ¼å¼ï¼Œæ¯”å¦‚ï¼šhttps://wq.360buyimg.com/fd/wx/img/gwq/face/xxx.pngã€‚æ‰€ä»¥"ä¹°ä¹°ä¹°"å®é™…ä¸Šæ˜¯å¯¹åº”https://wq.360buyimg.com/fd/wx/img/gwq/face/1.png

![ä¹°ä¹°ä¹°](./images/emoji4h5_1.png)  

è¿™é‡Œå®šä¹‰äº†"ä¹°ä¹°ä¹°"è¿™ä¸ªè¡¨æƒ…æ–‡æ¡ˆå¯¹åº”çš„emojiè¡¨æƒ…çš„è·¯å¾„ï¼Œå½“ç„¶è‡ªå®šä¹‰è¡¨æƒ…çš„æ–‡æ¡ˆå’Œå›¾ç‰‡è¦ä¸€ä¸€å¯¹åº”ä¸Šã€‚   
ä¸ºäº†ä¾¿äºåŒºåˆ†ç”¨æˆ·æ™®é€šæ–‡æ¡ˆï¼Œæˆ‘ä»¬é€šå¸¸è‡ªå®šä¹‰è¡¨æƒ…éƒ½ä¼šç»Ÿä¸€åŠ ä¸Š"[ ]",æ¯”å¦‚â€œä¹°ä¹°ä¹°â€æœ€ç»ˆæ˜¾ç¤ºçš„æ—¶å€™å°±æ˜¯"[ä¹°ä¹°ä¹°]"ã€‚ä¸ºäº†ä¿è¯ä¹‹å‰å·²ç»ä½¿ç”¨è¿‡çš„è¡¨æƒ…èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œåœ¨ç³»ç»Ÿé‡Œé¢[ä¹°ä¹°ä¹°]æ°¸è¿œéƒ½åªèƒ½å¯¹åº”è¿™ä¸ªå›¾ç‰‡è·¯å¾„ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ï¼Œåé¢ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬åé¢è§£é‡Šã€‚    

### è¡¨æƒ…è½¬æ–‡æœ¬

æœ‰äº†æ–‡æ¡ˆå’Œå›¾ç‰‡çš„å¯¹åº”å…³ç³»ï¼ŒæŒ‰ç…§ä¸šåŠ¡éœ€æ±‚ï¼Œå°†è¡¨æƒ…æ¸²æŸ“åœ¨è¡¨æƒ…é¢æ¿ä¸Šå³å¯ï¼Œè¿™æ ·åœ¨é¡µé¢çš„è¡¨æƒ…é¢æ¿å°±å¯ä»¥æ˜¾ç¤ºè¡¨æƒ…çš„å›¾ç‰‡è·¯å¾„ï¼Œç„¶åç”¨æˆ·é€‰æ‹©äº†æŸä¸ªè¡¨æƒ…ï¼Œåœ¨æ–‡æœ¬æ¡†åˆ™å¯¹åº”æ˜¾ç¤ºå›¾ç‰‡çš„æ–‡æ¡ˆï¼Œæ¯”å¦‚[ä¹°ä¹°ä¹°]ï¼Œå½“ç„¶å­˜å‚¨åœ¨ç³»ç»Ÿæ•°æ®åº“çš„ä¹Ÿæ˜¯[ä¹°ä¹°ä¹°]æ–‡æ¡ˆã€‚   

```js
"ä¹°ä¹°ä¹°": ["1",true,1] 
```
è¿™é‡Œæ•°ç»„çš„true,è¡¨ç¤ºå½“å‰è¡¨æƒ…æ˜¯å¦è¿˜åœ¨ä½¿ç”¨ï¼Œå¯¹äºä¸‹çº¿çš„è¡¨æƒ…ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“è¡¨æƒ…é¢æ¿çš„æ—¶å€™è¦å»é™¤ï¼Œä½†æ˜¯å·²ç»ç”Ÿæˆçš„è¡¨æƒ…åœ¨é¡µé¢ä¸­å¦‚æœæœ‰è¿˜éœ€è¦æ˜¾ç¤ºã€‚   
æ•°æ®çš„1ï¼Œä»£è¡¨è¯¥è¡¨æƒ…æ˜¾ç¤ºåœ¨è¡¨æƒ…é¢æ¿çš„ç¬¬å‡ å±ï¼Œæˆ‘è¿™é‡Œç¬¬ä¸€å±æ˜¯0ï¼Œæ‰€ä»¥1ä»£è¡¨æ˜¾ç¤ºåœ¨ç¬¬äºŒå±ã€‚   

```js
function getFaceList(panelIndex) {
    let arr = [];
    for (let txt in emojiData) {
        if (emojiData[txt][2] == panelIndex) { // æ‰¾åˆ°å¯¹åº”é¢æ¿çš„æ˜¾ç¤ºã€‚
            if (emojiData[txt][1]) {// ä¿è¯è¯¥è¡¨æƒ…æœªä¸‹çº¿
                let s = getFaceUrl(emojiData[txt]);
                s = `<a href="javascript:;" title="${txt}"> <img data-src="${s}"></a>`;
                arr.push(s);
            }
        }
    }
    return arr;
}
```
è¿™é‡Œæ˜¯æ¸²æŸ“è¡¨æƒ…é¢æ¿ï¼Œæ ¹æ®æ¸²æŸ“çš„é¢æ¿ç´¢å¼•æ¥æ¸²æŸ“æ•°æ®ï¼Œåªæœ‰è¯¥è¡¨æƒ…æœªä¸‹çº¿æ‰èƒ½æ¸²æŸ“åˆ°é¢æ¿é‡Œé¢ã€‚ 

```js
function getFaceUrl(emoji) {
    return `https://wq.360buyimg.com/fd/wx/img/gwq/face/${emoji[0]}.png`
}
```

### æ–‡æœ¬è½¬å›¾ç‰‡

åå°æŸ¥è¯¢çš„æ–‡æ¡ˆå½“ä¸­å¯èƒ½å«æœ‰è¡¨æƒ…ï¼Œåœ¨é¡µé¢æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æ–‡æœ¬è½¬æˆå›¾ç‰‡ã€‚
```js
function text2pic(txt) {
    if (!txt) {
        return '';
    }
    txt = txt.replace(/\[([^\]]+)\]/g, function (v1, v2) {
        //v1ï¼š [ä¹°ä¹°ä¹°]   v2ï¼šä¹°ä¹°ä¹°
        let d = emojiData[v2];
        return d ? '<img class="quan_icon_emoji" src="' + getFaceUrl(d) + '" />' : v1;
    });
    return txt;
}
```
è¿™é‡Œå°†éœ€è¦æ˜¾ç¤ºçš„æ–‡æœ¬å…¨é‡æœç´¢[xxx]çš„å†…å®¹ï¼Œç„¶åå’Œæˆ‘ä»¬è‡ªå®šä¹‰çš„emojiè¡¨æƒ…å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šäº†,å°±è¯´æ˜æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰è¡¨æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¾“å‡ºä¸€ä¸ªimgå›¾ç‰‡æ ‡ç­¾ã€‚   

å½“ç„¶è¿™é‡Œä¹ŸåŒºåˆ«ä¸äº†è¿™ä¸ªè¡¨æƒ…åˆ°åº•æ˜¯ä½ åœ¨é¢æ¿é€‰æ‹©çš„emoji[ä¹°ä¹°ä¹°]ï¼Œè¿˜æ˜¯ä½ è‡ªè¡Œåœ¨æ–‡æœ¬æ¡†è¾“å…¥çš„æ–‡æ¡ˆ[ä¹°ä¹°ä¹°]ã€‚ä½ ä¹Ÿä¼šå‘ç°å¾®ä¿¡çš„[æ‡µé€¼]å®é™…ä¸Šæ˜¯åŒºåˆ†è¡¨æƒ…å’Œæ–‡æœ¬äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¹Ÿéœ€è¦è¿™ä¹ˆåšçš„è¯ï¼Œåœ¨ä¼ å…¥åå°çš„æ—¶å€™å°±ä¸èƒ½å•å•åªæ˜¯ä¼ å…¥[ä¹°ä¹°ä¹°]è¿™ä¸ªæ–‡æ¡ˆäº†ï¼Œæ¯”å¦‚\<span class="emoji1">[ä¹°ä¹°ä¹°]</span>ï¼Œé‚£æˆ‘ä»¬ä¹‹å‰çš„è¯†åˆ«ä¹Ÿéœ€è¦æŒ‰è¿™ä¸ªè§„åˆ™æ¥äº†ã€‚æœ‰å…´è¶£å’Œéœ€è¦çš„å¯ä»¥è¯•ä¸‹ã€‚  

> ç”±äºè¿™é‡Œå°†æ™®é€šæ–‡æœ¬è½¬æ¢æˆäº†å¯Œæ–‡æœ¬ï¼Œæ‰€ä»¥ç‰¹åˆ«è¦æ³¨æ„xssçš„é—®é¢˜ã€‚åœ¨è½¬æ¢è¡¨æƒ…å‰åšä¸€æ¬¡xsså¤„ç†ã€‚ç¡®ä¿ä¸å‡ºç°xssé—®é¢˜ï¼Œç„¶ååœ¨å°†å¯Œæ–‡æœ¬å†…å®¹æ¸²æŸ“åˆ°é¡µé¢ã€‚


## ç³»ç»Ÿé»˜è®¤emojiè¡¨æƒ…

ä¸Šè¿°è‡ªå®šä¹‰è¡¨æƒ…å¯ä»¥è§£å†³æˆ‘ä»¬ç³»ç»Ÿå½“ä¸­éœ€è¦æœ‰ç‰¹æ®Šæ„ä¹‰çš„emojiè¡¨æƒ…ï¼Œæ¯”å¦‚[ä¹°ä¹°ä¹°]çš„è¡¨æƒ…ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸šåŠ¡çš„ç‰¹æ®Šè¡¨æƒ…ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªemojiã€‚  

ä½†æ˜¯ç³»ç»Ÿemojiè¦æ³¨æ„ï¼Œå®ƒåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¯èƒ½æ˜¾ç¤ºçš„æ ·å¼ä¼šæœ‰ç‚¹å·®åˆ«ï¼Œä¸è¿‡æ”¾å¿ƒå¤§ç¬‘ç»ˆç©¶æ˜¯å¤§ç¬‘ï¼Œåœ¨å“ªä¸ªç³»ç»Ÿä¸‹éƒ½ä¸ä¼šå˜æˆå¤§å“­ï¼Œå¦‚æœè¦æ±‚ä¸é‚£ä¹ˆé«˜çš„æ„Ÿè§‰é—®é¢˜ä¸å¤§ï¼Œåªè¦çŸ¥é“æœ‰è¿™ä¸ªæ˜¾ç¤ºå·®å¼‚å°±è¡Œäº†ã€‚   
### Unicodeç emojiè¡¨æƒ…

å¤§ç¬‘ğŸ˜„çš„Unicodeï¼š\uD83D\uDE04   

åœ¨ç”¨æˆ·çš„è¾“å…¥æ³•è¾“å…¥é»˜è®¤emojiè¡¨æƒ…ï¼Œåœ¨å­˜å‚¨åå°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†ä¸‹ï¼Œå°†å…¶è½¬æ¢æˆunicodeç å­˜å‚¨ï¼Œæ¯”å¦‚è°ƒç”¨æ–¹æ³•emoji2Unicodeæ¥è½¬æ¢ã€‚   
```js
function emoji2Unicode (emoji) {
    let str = '';
    if (emoji && emoji.length > 0) {
        for (const char of emoji) {
            const index = char.codePointAt(0);
            if (index > 65535) {
                const h =
                    '\\u' +
                    (Math.floor((index - 0x10000) / 0x400) + 0xd800).toString(
                        16
                    );
                const c =
                    '\\u' + ((index - 0x10000) % 0x400 + 0xdc00).toString(16);
                str = str + h + c;
            } else {
                str += char;
            }
        }
    }
    return str;
}
```  
åå°å¦‚æœå­˜å‚¨ä¸ºunicodeç çš„emojiäº†ï¼Œè¿”å›åˆ°å‰ç«¯çš„æ—¶å€™ï¼Œä¸éœ€è¦ç‰¹æ®Šä½¿ç”¨innerHTMLæˆ–è€…vueçš„v-htmlæ¥æ˜¾ç¤ºã€‚å½“åšæ™®é€šæ–‡æœ¬æ˜¾ç¤ºå³å¯ã€‚æ¯”å¦‚å¦‚ä¸‹ä¸¤ç§éƒ½å¯ä»¥æ˜¾ç¤ºä¸ºè¡¨æƒ…ğŸ˜„ï¼š  

```html
document.getElementById("emojiWrap").innerHTML='\uD83D\uDE04';
document.getElementById("emojiWrap").innerText='\uD83D\uDE04';
```  

> å¦‚æœæˆ‘ä»¬è°ƒç”¨åå°æ˜¯ä¼ å‚unicodeç ï¼Œæ¯”å¦‚\uD83D\uDE04ï¼Œé‚£ä¹ˆå‰ç«¯æŸ¥è¯¢è¿”å›çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ˜¯æ–‡æœ¬\uD83D\uDE04ï¼Œè¿™é‡Œåå°æ•°æ®åº“éœ€è¦æ”¯æŒunicodeå­—ç¬¦å­˜å‚¨ï¼Œæœ¬æ–‡å…ˆä¸åšè®¨è®ºï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç¿»é˜…ã€‚

### HTMLå®ä½“å­˜å‚¨emojiè¡¨æƒ…

é™¤äº†ä½¿ç”¨unicodeç å­˜å‚¨emojiè¡¨æƒ…ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡å–htmlå®ä½“å­˜å‚¨çš„æ–¹å¼æ¥å®ç°ã€‚  

ç”¨æˆ·æ‰‹æœºè¾“å…¥æ³•è¾“å…¥è¡¨æƒ…ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è½¬æ¢æˆå®ä½“å­˜å‚¨ã€‚  

#### emoji ==>  html entity
```JS
function emoji2HtmlEntity (str) {
    const patt = /[\ud800-\udbff][\udc00-\udfff]/g;
    str = str.replace(patt, function (char) {
        let H, L, code;
        if (char.length === 2) {
            H = char.charCodeAt(0); // å–å‡ºé«˜ä½
            L = char.charCodeAt(1); // å–å‡ºä½ä½
            code = (H - 0xd800) * 0x400 + 0x10000 + L - 0xdc00; // è½¬æ¢ç®—æ³•
            return '&#' + code + ';';
        } else {
            return char;
        }
    });
    return str;
}
```  
è¿™é‡Œå°†è¡¨æƒ…è½¬æ¢ä¸ºäº†å®ä½“å­˜å‚¨ï¼Œè¿™ä¸ªhtml entityå¯¹äºæ•°æ®åº“å­˜å‚¨æ²¡æœ‰è¦æ±‚ï¼Œåªè¦èƒ½å­˜å‚¨å­—ç¬¦ä¸²å°±OKã€‚æ¯”å¦‚å¦‚ä¸‹ä¾‹å­ï¼š  

```JS
emoji2HtmlEntity('ğŸ˜„')  ==>  &#128516;
```
å°†è¿™ä¸ªhtmlå®ä½“&#128516å­˜å‚¨åœ¨åå°ï¼Œç„¶åå‰ç«¯æŸ¥è¯¢çš„æ—¶å€™ï¼ŒåŸæ ·è¿”å›å³å¯ã€‚

#### html entity ==> emoji

é€šå¸¸htmlå®ä½“æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ¸²æŸ“ï¼Œæ¯”å¦‚ï¼š  

```html
document.getElementById("emojiWrap").innerHTML='&#128516';
```

ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½ä½¿ç”¨innerTextæ¥æ˜¾ç¤ºhtml entityï¼Œåªä¼šæ˜¾ç¤ºæ–‡æœ¬åŸæ ·å†…å®¹ï¼Œå¦å¤–åœ¨å¾®ä¿¡å°ç¨‹åºä¸­åˆä¸å¥½æ˜¾ç¤ºäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€é‡‡å–å°†html entityè½¬æ¢æˆunicodeç æ¥æ–¹å¼æ¥æ˜¾ç¤ºã€‚  

å¦‚ä¸‹ï¼šhe.js  
```js
const regexInvalidEntity = /&#(?:[xX][^a-fA-F0-9]|[^0-9xX])/;
const regexDecode = /&(Gt|GT|ii);|&(gt|lt)(?!;)([=a-zA-Z0-9]?)|&#([0-9]+)(;?)|&#[xX]([a-fA-F0-9]+)(;?)|&([0-9a-zA-Z]+)/g;
const decodeMapNumeric = { '0': '\uFFFD', '128': '\u20AC', '130': '\u201A', '131': '\u0192', '132': '\u201E', '133': '\u2026', '134': '\u2020', '135': '\u2021', '136': '\u02C6', '137': '\u2030', '138': '\u0160', '139': '\u2039', '140': '\u0152', '142': '\u017D', '145': '\u2018', '146': '\u2019', '147': '\u201C', '148': '\u201D', '149': '\u2022', '150': '\u2013', '151': '\u2014', '152': '\u02DC', '153': '\u2122', '154': '\u0161', '155': '\u203A', '156': '\u0153', '158': '\u017E', '159': '\u0178' };
const invalidReferenceCodePoints = [1, 2, 3, 4, 5, 6, 7, 8, 11, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 64976, 64977, 64978, 64979, 64980, 64981, 64982, 64983, 64984, 64985, 64986, 64987, 64988, 64989, 64990, 64991, 64992, 64993, 64994, 64995, 64996, 64997, 64998, 64999, 65000, 65001, 65002, 65003, 65004, 65005, 65006, 65007, 65534, 65535, 131070, 131071, 196606, 196607, 262142, 262143, 327678, 327679, 393214, 393215, 458750, 458751, 524286, 524287, 589822, 589823, 655358, 655359, 720894, 720895, 786430, 786431, 851966, 851967, 917502, 917503, 983038, 983039, 1048574, 1048575, 1114110, 1114111];

const stringFromCharCode = String.fromCharCode;

const object = {};
const hasOwnProperty = object.hasOwnProperty;
const has = function (object, propertyName) {
    return hasOwnProperty.call(object, propertyName);
};

const contains = function (array, value) {
    let index = -1;
    const length = array.length;
    while (++index < length) {
        if (array[index] == value) {
            return true;
        }
    }
    return false;
};

const merge = function (options, defaults) {
    if (!options) {
        return defaults;
    }
    const result = {};
    let key;
    for (key in defaults) {
        // A `hasOwnProperty` check is not needed here, since only recognized
        // option names are used anyway. Any others are ignored.
        result[key] = has(options, key) ? options[key] : defaults[key];
    }
    return result;
};

const parseError = function (message) {
    throw Error('Parse error: ' + message);
};
const codePointToSymbol = function (codePoint, strict) {
    let output = '';
    if ((codePoint >= 0xD800 && codePoint <= 0xDFFF) || codePoint > 0x10FFFF) {
        if (strict) {
            parseError('character reference outside the permissible Unicode range');
        }
        return '\uFFFD';
    }
    if (has(decodeMapNumeric, codePoint)) {
        if (strict) {
            parseError('disallowed character reference');
        }
        return decodeMapNumeric[codePoint];
    }
    if (strict && contains(invalidReferenceCodePoints, codePoint)) {
        parseError('disallowed character reference');
    }
    if (codePoint > 0xFFFF) {
        codePoint -= 0x10000;
        output += stringFromCharCode(codePoint >>> 10 & 0x3FF | 0xD800);
        codePoint = 0xDC00 | codePoint & 0x3FF;
    }
    output += stringFromCharCode(codePoint);
    return output;
};

const decode = function (html, options) {
    options = merge(options, decode.options);
    const strict = options.strict;
    if (strict && regexInvalidEntity.test(html)) {
        parseError('malformed character reference');
    }
    return html.replace(regexDecode, function ($0, $1, $2, $3, $4, $5, $6, $7, $8) {
        let codePoint;
        let semicolon;
        let decDigits;
        let hexDigits;

        if ($4) {
            // Decode decimal escapes, e.g. `&#119558;`.
            decDigits = $4;
            semicolon = $5;
            if (strict && !semicolon) {
                parseError('character reference was not terminated by a semicolon');
            }
            codePoint = parseInt(decDigits, 10);
            return codePointToSymbol(codePoint, strict);
        }

        if ($6) {
            // Decode hexadecimal escapes, e.g. `&#x1D306;`.
            hexDigits = $6;
            semicolon = $7;
            if (strict && !semicolon) {
                parseError('character reference was not terminated by a semicolon');
            }
            codePoint = parseInt(hexDigits, 16);
            return codePointToSymbol(codePoint, strict);
        }

        // If weâ€™re still here, `if ($7)` is implied; itâ€™s an ambiguous
        // ampersand for sure. https://mths.be/notes/ambiguous-ampersands
        if (strict) {
            parseError(
                'named character reference was not terminated by a semicolon'
            );
        }
        return $0;
    });
};
decode.options = {
    'isAttributeValue': false,
    'strict': false
};
export default decode;
```
è¿™ä¸ªçš„å®ç°è¿‡ç¨‹ï¼Œæˆ‘å°±ä¸å†é˜è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯»ä¸‹ï¼Œè¿˜æ¯”è¾ƒç®€å•ã€‚  
åœ¨æ‹¿åˆ°æ–‡æœ¬ä¹‹åï¼Œæˆ‘ä»¬å…ˆç”¨heå¤„ç†ä¸‹ï¼š  

```JS
import decode from './he';
text = decode(text);
```
è¿™æ ·åˆå°†htmlå®ä½“è½¬æ¢æˆèƒ½å¯ç›´æ¥æ˜¾ç¤ºçš„unicodeç çš„emojiè¡¨æƒ…äº†ï¼Œåœ¨å°ç¨‹åºä¸­ä¹Ÿå¯ä»¥ç›´æ¥æ˜¾ç¤ºäº†ã€‚å½“ç„¶è¿™ä¸ªå¼ºå¤§çš„åº“ä¸ä»…ä»…åªæ˜¯è½¬æ¢emojiè¡¨æƒ…ï¼Œå¯ä»¥å‚è€ƒï¼š https://github.com/mathiasbynens/he


